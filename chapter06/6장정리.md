# 6ì¥ ë‹¤ì–‘í•œ ì—°ê´€ê´€ê³„ ë§¤í•‘

---

## 6.1 ë‹¤ëŒ€ì¼
ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ 1:N ê´€ê³„ì—ì„œ ì™¸ë˜ í‚¤ëŠ” í•­ìƒ ë‹¤ìª½ì— ìˆë‹¤.
<br>ë”°ë¼ì„œ ê°ì²´ ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í•­ìƒ ë‹¤ìª½ì´ë‹¤.
<br>ì˜ˆë¥¼ë“¤ì–´ 5ì¥ì—ì„œ ì´ì•¼ê¸°í–ˆë˜ íšŒì›(N)ê³¼ íŒ€(1)ì´ ìˆìœ¼ë©´ íšŒì›ì´ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ë‹¤.

### 6.1.1 ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥[N:1]

---
![img_01.png](./img/img_01.png)

``` java
@Entity
public class Member {
    
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")       
    private Team team;
    
    // Getter, Setter...
}

/** ====================================== */

@Entity
public class Team {
    
    @Id @GeneratedValue
    @Column(name= "TEAM_ID")
    private Long id;
    
    private String name;
    
    // Getter, Setter ...
    
}
```
íšŒì›ì€ Member.team ìœ¼ë¡œ íŒ€ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆì§€ë§Œ ë°˜ëŒ€ë¡œ íŒ€ì—ëŠ” íšŒì›ì„ ì°¸ì¡°í•˜ëŠ” í•„ë“œê°€ ì—†ë‹¤.
<br> ë”°ë¼ì„œ íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ë‹¨ë°˜í–¥ ì—°ê´€ê´€ê³„ì´ë‹¤.

```
@JoinColumn(name = "TEAM_ID") ë¥¼ ì‚¬ìš©í•´ì„œ Member.team í•„ë“œë¥¼ TEAM_ID ì™¸ë˜ í‚¤ì™€ ë§¤í•‘
ë”°ë¼ì„œ Member.team í•„ë“œë¡œ íšŒì› í…Œì´ë¸”ì˜ TEAM_ID ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬
```

### 6.1.2 ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥[N:1, 1:N]
![img_02.png](./img/img_02.png)
```java
@Entity
public class Member {
    @Id @GenerateValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
    
    public void setTeam(Team team) {
        this.team = team;
        // ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
        if(!team.getMembers().contains(this)) {
            team.getMembers().add(this);
        }
    }
}

/** ====================================== */

@Entity
public class Team {

    @Id @GeneratedValue
    @Column(name= "TEAM_ID")
    private Long id;

    private String name;

    @OneToMany(mappedBy = "team")
    private List<Member> members = new ArrayList<Member>();
    
    public void addMember(Member member) {
        this.members.add(member);
        if(member.getTeam() != this) {      // ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
            member.getTeam(this);
        }
    }
    
    // Getter, Setter ...

}
```
#### ğŸ”» ì–‘ë°©í–¥ì€ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìª½ì´ ì—°ê´€ê´€ê³„ ì£¼ì¸
+ ì¼ëŒ€ë‹¤ì™€ ë‹¤ëŒ€ì¼ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ë‹¤(N)ì— ì™¸ë˜ í‚¤ê°€ ìˆë‹¤. 
<br> ìœ„ì˜ ì˜ˆëŠ” MEMBER í…Œì´ë¸”ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ Member.teamì´ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ë‹¤.
+ JPAëŠ” ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í• ë•Œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œ ì‚¬ìš©
+ ì£¼ì¸ì´ ì•„ë‹Œ Team.membersëŠ” ì¡°íšŒë¥¼ ìœ„í•œ JPQLì´ë‚˜ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í• ë•Œ ì‚¬ìš©

#### ğŸ”» ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ì„œë¡œë¥¼ ì°¸ì¡° 
+ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ì„œë¡œ ì°¸ì¡°í•´ì•¼ í•œë‹¤.
<br> ì–´ëŠ í•œ ìª½ë§Œ ì°¸ì¡°í•˜ë©´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ì„±ë¦½í•˜ì§€ ì•ŠìŒ
<br> í•­ìƒ ì„œë¡œ ì°¸ì¡°í•˜ê²Œ í•˜ë ¤ë©´ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ì‘ì„±í•˜ëŠ”ê²ƒì´ ì¢‹ë‹¤. 
--> setTeam(), addMember() ê°™ì€ ë©”ì†Œë“œ
+ í¸ì˜ ë©”ì†Œë“œëŠ” í•œ ê³³ì—ë§Œ ì‘ì„±í•˜ê±°ë‚˜ ì–‘ìª½ ë‹¤ ì‘ì„±í•  ìˆ˜ ìˆëŠ”ë°, ì–‘ìª½ì— ë‹¤ ì‘ì„±í•˜ë©´ ë¬´í•œë£¨í”„ì— ë¹ ì§€ë¯€ë¡œ ì£¼ì˜

## 6.2 ì¼ëŒ€ë‹¤
ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” ë‹¤ëŒ€ì¼ ê´€ê³„ì˜ ë°˜ëŒ€ ë°©í–¥ì´ë‹¤.
ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” ì—”í‹°í‹°ë¥¼ í•˜ë‚˜ ì´ìƒ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìë°” ì»¬ë ‰ì…˜ì¸ Collection, List, Set, Map ì¤‘ì— í•˜ë‚˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

### 6.2.1 ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥[1:N]
í•˜ë‚˜ì˜ íŒ€ì€ ì—¬ëŸ¬ íšŒì›ì„ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ”ë° ì´ëŸ° ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤ ê´€ê³„
íŒ€ì€ íšŒì›ë“¤ì€ ì°¸ì¡°í•˜ì§€ë§Œ ë°˜ëŒ€ë¡œ íšŒì›ì€ íŒ€ì„ ì°¸ì¡°í•˜ì§€ ì•Šìœ¼ë©´ ë‘˜ì˜ ê´€ê³„ëŠ” ë‹¨ë°©í–¥
(ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ê´€ê³„ëŠ” JPA 2.0 ë¶€í„° ì§€ì›)
![img_03.png](./img/img_03.png)
+ íŒ€ ì—”í‹°í‹°ì˜ Team.membersë¡œ íšŒì› í…Œì´ë¸”ì˜ TEAM_ID ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•œë‹¤.
+ ë³´í†µ ìì‹ ì´ ë§¤í•‘í•œ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ì´ ë§¤í•‘ì€ ë°˜ëŒ€ìª½ í…Œì´ë¸”ì— ìˆëŠ” ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬
+ ì¼ëŒ€ë‹¤ ê´€ê³„ì—ì„œ ì™¸ë˜ í‚¤ëŠ” í•­ìƒ ë‹¤ìª½ì— ìˆì§€ë§Œ ë‹¤ìª½ì¸ Member ì—”í‹°í‹°ì—ëŠ” ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•  ìˆ˜ ìˆëŠ” ì°¸ì¡° í•„ë“œê°€ ì—†ê³  
<br> ë°˜ëŒ€ìª½ì¸ Team ì—”í‹°í‹°ì—ë§Œ ì°¸ì¡° í•„ë“œì¸ membersê°€ ìˆì–´ ë°˜ëŒ€í¸ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬

```java
@Entity
public class Team {
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;
    
    private String name;
    
    @OneToMany
    @JoinColumn(name = "TEAM_ID")       // MEMBER í…Œì´ë¸”ì˜ TEAM_ID (FK)
    private List<Member> members = new ArrayList<Member>();
    
    // Getter, Setter..
}

/** ====================================== */

@Entity
public class Member {
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    // Getter, Setter ...
}
```
+ ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ê´€ê³„ë¥¼ ë§¤í•‘í•  ë•Œ @JoinColumnì„ ëª…ì‹œí•´ì•¼ í•œë‹¤.
<br> ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ JPAëŠ” ì—°ê²° í…Œì´ë¸”ì„ ì¤‘ê°„ì— ë‘ê³  ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¡°ì¸ í…Œì´ë¸” ì „ëµì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•´ì„œ ë§¤í•‘

#### ğŸ”» ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì˜ ë‹¨ì 
+ ë§¤í•‘í•œ ê°ì²´ê°€ ê´€ë¦¬í•˜ëŠ” ì™¸ë˜ í‚¤ê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì— ìˆë‹¤ëŠ” ì 
<br> ë³¸ì¸ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆìœ¼ë©´ ì—”í‹°í‹°ì˜ ì €ì¥ê³¼ ì—°ê´€ê´€ê³„ ì²˜ë¦¬ë¥¼ Insert SQL í•œë²ˆìœ¼ë¡œ ëë‚¼ ìˆ˜ ìˆì§€ë§Œ,
ë‹¤ë¥¸ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆìœ¼ë©´ ì—°ê´€ê´€ê³„ ì²˜ë¦¬ë¥¼ ìœ„í•œ Update SQLì„ ì¶”ê°€ë¡œ ì‹¤í–‰í•´ì•¼ í•œë‹¤.

```java
public void testSave() {
    
    Member member1 = new Member("member1");
    Member member2 = new Member("member2");
    
    Team team1 = new Team("team1");
    team1.getMembers().add(member1);
    team1.getMembers().add(member2);
    
    em.persist(member1);    // Insert member1
    em.persist(member2);    // Insert member2
    em.persist(team1);      // Insert team, update member1.fk, update member2.fk
        
    transaction.commit();
}
```
+ Member ì—”í‹°í‹°ëŠ” Team ì—”í‹°í‹°ë¥¼ ëª¨ë¥¸ë‹¤. 
<br> ê·¸ë¦¬ê³  ì—°ê´€ê´€ê³„ì— ëŒ€í•œ ì •ë³´ëŠ” Team ì—”í‹°í‹°ì˜ membersê°€ ê´€ë¦¬í•œë‹¤.
+ Member ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•ŒëŠ” MEMBER í…Œì´ë¸”ì˜ TEAM_ID ì™¸ë˜ í‚¤ì— ì•„ë¬´ ê°’ë„ ì €ì¥ë˜ì§€ ì•ŠìŒ
+ Team ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ Team.membersì˜ ì°¸ì¡° ê°’ì„ í™•ì¸í•´ì„œ íšŒì› í…Œì´ë¸”ì— ìˆëŠ” TEAM_ID ì™¸ë˜ í‚¤ë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.

#### ğŸ”» ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ë³´ë‹¤ëŠ” ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©
ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ë¥¸ í…Œì´ë¸”ì—ì„œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.
<br> ì´ê²ƒì€ ì„±ëŠ¥ ë¬¸ì œë„ ìˆì§€ë§Œ ê´€ë¦¬ë„ ë¶€ë‹´ìŠ¤ëŸ½ë‹¤.
<br> ì´ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì€ ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©
<br> ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ì€ ë³¸ì¸ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆì–´ ë‹¨ë°©í–¥ ë§¤í•‘ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

### 6.2.2 ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥[1:N, N:1]
ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ ë§¤í•‘ì€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©° ëŒ€ì‹  ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©
(ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ê³¼ ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ì€ ì‚¬ì‹¤ ë˜‘ê°™ì€ ë§ì´ë‹¤.)
+ ì–‘ë°©í–¥ ë§¤í•‘ì—ì„œ @OneToManyëŠ” ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ë  ìˆ˜ ì—†ë‹¤.
+ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ íŠ¹ì„±ìƒ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ëŠ” í•­ìƒ ë‹¤ ìª½ì— ì™¸ë˜ í‚¤ê°€ ìˆë‹¤.
+ ë”°ë¼ì„œ @OneToMany, @ManyToOne ë‘˜ ì¤‘ì— ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í•­ìƒ ë‹¤ ìª½ì¸ @ManyToOneì„ ì‚¬ìš©í•˜ëŠ” ê³³ì´ë‹¤.
+ ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì´ ì™„ì „íˆ ë¶ˆê°€ëŠ¥í•œ ê²ƒì´ ì•„ë‹ˆë©° ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ ë°˜ëŒ€í¸ì— ê°™ì€ ì™¸ë˜ í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì½ê¸° ì „ìš©ìœ¼ë¡œ í•˜ë‚˜ ì¶”ê°€í•˜ë©´ ëœë‹¤.

![img_04.png](./img/img_04.png)

```java
@Entity
public class Team {
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;
    
    private String name;
    
    @OneToMay
    @JoinColumn(name = "TEAM_ID")
    private List<Member> members = new ArrayList<Member>();
    
    //Getter, Setter...
}

/** ====================================== */

@Entity
public class Member {
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    private String username;
    
    @ManyToOne
    @JoinColumn(name = "TEAM_ID", insertable = false, updatable = false)
    private Team team;
    
    // Getter, Setter ...
}
```
ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ ë°˜ëŒ€í¸ì— ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì¶”ê°€í•¨
<br> ì´ë•Œ ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ê³¼ ê°™ì€ TEAM_ID ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì„ ë§¤í•‘í•¨
ì´ë ‡ê²Œ í•˜ë©´ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤... --> ë¬´ìŠ¨ ë¬¸ì œ...???
+ ë°˜ëŒ€í¸ì¸ ë‹¤ëŒ€ì¼ ìª½ì€ insertable = false, updatable = falseë¡œ ì„¤ì •í•´ì„œ ì½ê¸°ë§Œ ê°€ëŠ¥
+ ì´ ë°©ë²•ì€ ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ ë§¤í•‘ë³´ë‹¤ëŠ” ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ ë°˜ëŒ€í¸ì— ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì¶”ê°€í•´ì„œ 
ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ì²˜ëŸ¼ ë³´ì´ë„ë¡ í•˜ëŠ” ë°©ë²•
+ ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì´ ê°€ì§€ëŠ” ë‹¨ì ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ ê°€ëŠ¥í•˜ë©´ ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©

## 6.3 ì¼ëŒ€ì¼ [1:1]
ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ì–‘ìª½ì´ ì„œë¡œ í•˜ë‚˜ì˜ ê´€ê³„ë§Œ ê°€ì§„ë‹¤.
+ íšŒì›ì€ í•˜ë‚˜ì˜ ì‚¬ë¬¼í•¨ë§Œ ì‚¬ìš©
+ ì‚¬ë¬¼í•¨ë„ í•˜ë‚˜ì˜ íšŒì›ì— ì˜í•´ì„œë§Œ ì‚¬ìš©

#### ì¼ëŒ€ì¼ ê´€ê³„ íŠ¹ì§• 
+ ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ê·¸ ë°˜ëŒ€ë„ ì¼ëŒ€ì¼ ê´€ê³„
+ í…Œì´ë¸” ê´€ê³„ì—ì„œ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ì€ í•­ìƒ ë‹¤(N)ìª½ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ë‹¤. ë°˜ë©´ì— ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ì£¼ í…Œì´ë¸”ì´ë‚˜ ëŒ€ìƒ í…Œì´ë¸” ë‘˜ ì¤‘ ì–´ëŠ ê³³ì´ë‚˜ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
+ í…Œì´ë¸”ì€ ì£¼ í…Œì´ë¸”ì´ë“  ëŒ€ìƒ í…Œì´ë¸”ì´ë“  ì™¸ë˜ í‚¤ í•˜ë‚˜ë§Œ ìˆìœ¼ë©´ ì–‘ìª½ìœ¼ë¡œ ì¡°íšŒ í•  ìˆ˜ ìˆë‹¤.

#### ğŸ”» ì£¼ í…Œì•„ë¸”ì— ì™¸ë˜ í‚¤
+ ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ë¥¼ ë‘ê³  ëŒ€ìƒ í…Œì´ë¸”ì„ ì°¸ì¡°
+ ì™¸ë˜ í‚¤ë¥¼ ê°ì²´ ì°¸ì¡°ì™€ ë¹„ìŠ·í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ ê°ì²´ì§€í–¥ ê°œë°œìë“¤ì´ ì„ í˜¸
+ ì´ ë°©ë²•ì˜ ì¥ì ì€ ì£¼ í…Œì´ë¸”ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆì–´ ì£¼ í…Œì´ë¸”ë§Œ í™•ì¸í•´ë„ ëŒ€ìƒ í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ê°€ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.
#### ğŸ”» ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ 
+ ì „í†µì ì¸ ë°ì´í„°ë² ì´ìŠ¤ ê°œë°œìë“¤ì€ ë³´í†µ ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ë¥¼ ë‘ëŠ” ê²ƒì„ ì„ í˜¸
+ ì´ ë°©ë²•ì˜ ì¥ì ì€ í…Œì´ë¸” ê´€ê³„ë¥¼ ì¼ëŒ€ì¼ì—ì„œ ì¼ëŒ€ë‹¤ë¡œ ë³€ê²½í•  ë•Œ í…Œì´ë¸” êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.

### 6.3.1 ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ 
JPAë„ ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆìœ¼ë©´ ì¢€ ë” í¸ë¦¬í•˜ê²Œ ë§¤í•‘í•  ìˆ˜ ìˆë‹¤.

#### ë‹¨ë°©í–¥
![img_05.png](./img/img_05.png)
``` java
@Entity
public class Member {
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    @OneToOne
    @JoinColumn(name = "LOCKER_ID")
    private Locker locker;
}

/** ====================================== */

@Entity
public class Locker {
    @Id @GeneratedValue
    @Column(name = "LOCKER_ID")
    private Long id;
    
    private String name;
}
```
+ ì¼ëŒ€ì¼ ê´€ê³„ì´ë¯€ë¡œ ê°ì²´ ë§¤í•‘ì— @OneToOneì„ ì‚¬ìš©í–ˆê³  ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” LOCKER_ID ì™¸ë˜ í‚¤ì— ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´(UNI)ì„ ì¶”ê°€í•¨

#### ì–‘ë°©í–¥
![img_06.png](./img/img_06.png)
``` java
@Entity
public class Member {
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    @OneToOne
    @JoinColumn(name = "LOCKER_ID")
    private Locker locker;
}

/** ====================================== */

@Entity
public class Locker {
    @Id @GeneratedValue
    @Column(name = "LOCKER_ID")
    private Long id;
    
    private String name;
    
    @OneToOne(mappedBy = "locker")
    private Member member;
}
```
+ ì–‘ë°©í–¥ì´ë¯€ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•´ì•¼ í•œë‹¤.
+ MEMBER í…Œì´ë¸”ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ Member ì—”í‹°í‹°ì— ìˆëŠ” Member.lockerê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë‹¤.
+ ë°˜ëŒ€ ë§¤í•‘ì¸ ì‚¬ë¬¼í•¨ì˜ Locker.memberëŠ” mappedByë¥¼ ì„ ì–¸í•´ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹ˆë¼ê³  ì„¤ì •

### 6.3.2 ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤

#### ë‹¨ë°©í–¥
![img_07.png](./img/img_07.png)
+ ì¼ëŒ€ì¼ ê´€ê³„ì¤‘ ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ë‹¨ë°©í–¥ ê´€ê³„ëŠ” JPAì—ì„œ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©° ê·¸ë¦¼ê³¼ ê°™ì´ ë§¤í•‘í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë„ ì—†ë‹¤.
+ ë‹¨ë°©í–¥ ê´€ê³„ë¥¼ Lockerì—ì„œ Member ë°©í–¥ìœ¼ë¡œ ìˆ˜ì •í•˜ê±°ë‚˜, ì–‘ë°©í–¥ ê´€ê³„ë¡œ ë§Œë“¤ê³  Lockerë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•¨

#### ì–‘ë°©í–¥
![img_08.png](./img/img_08.png)
```java
@Entity
public class Member {
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    @OneToOne(mappedBy = "member")
    private Locker locker;
}

/** ====================================== */

@Entity
public class Locker {
    @Id @GeneratedValue
    @Column(name = "LOCKER_ID")
    private Long id;
    
    private String name;
    
    @OneToOne
    @JoinColumn(name = "MEMBER_ID")
    private Member member;
}
```
+ ì£¼ ì—”í‹°í‹°ì¸ Member ì—”í‹°í‹° ëŒ€ì‹ ì— ëŒ€ìƒ ì—”í‹°í‹°ì¸ Lockerë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ LOCKER í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ë„ë¡ í•¨
```
í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•  ë•Œ ì™¸ë˜ í‚¤ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ë„ ì¦‰ì‹œ ë¡œë”©ë¨
ë°©ê¸ˆ ì˜ˆì œì—ì„œ Locker.memberëŠ” ì§€ì—° ë¡œë”©í•  ìˆ˜ ìˆì§€ë§Œ, Member.lockerëŠ” ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ë„ ì¦‰ì‹œ ë¡œë”©ë¨
ì´ê²ƒì€ í”„ë¡ì‹œì˜ í•œê³„ ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ë¬¸ì œì¸ë° í”„ë¡ì‹œ ëŒ€ì‹ ì— bytecode instrumentaionì„ ì‚¬ìš©í•˜ë©´ í•´ê²°í•¨
```
## 6.4 ë‹¤ëŒ€ë‹¤ [N:N]
ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì •ê·œí™”ëœ í…Œì´ë¸” 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤.
ê·¸ë˜ì„œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ë‚´ëŠ” ì—°ê²° í…Œì´ë¸”ì„ ì‚¬ìš©í•œë‹¤.
![img_09.png](./img/img_09.png)
ìœ„ ê·¸ë¦¼ì„ ë³´ë©´ íšŒì› í…Œì´ë¸”ê³¼ ìƒí’ˆ í…Œì´ë¸”ì€ ë‹¤ëŒ€ë‹¤ ê´€ê³„ì´ë‹¤.
+ íšŒì›ë“¤ì€ ìƒí’ˆì„ ì£¼ë¬¸í•œë‹¤.
+ ìƒí’ˆë“¤ì€ íšŒì›ë“¤ì— ì˜í•´ ì£¼ë¬¸ëœë‹¤.
<br> íšŒì› í…Œì´ë¸”ê³¼ ì£¼ë¬¸ í…Œì´ë¸”ë§Œìœ¼ë¡œ ê´€ê³„ë¥¼ í‘œí˜„ì„ í•  ìˆ˜ê°€ ì—†ì–´ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ì—°ê²° í…Œì´ë¸” ì¶”ê°€

![img_10.png](./img/img_10.png)
ê·¸ëŸ°ë° ê°ì²´ëŠ” í…Œì´ë¸”ê³¼ ë‹¤ë¥´ê²Œ ê°ì²´ 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ
+ íšŒì› ê°ì²´ëŠ” ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•´ì„œ ìƒí’ˆë“¤ì„ ì°¸ì¡°
+ ë°˜ëŒ€ë¡œ ìƒí’ˆë“¤ë„ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•´ì„œ íšŒì›ë“¤ì„ ì°¸ì¡°

![img_11.png](./img/img_11.png)

### 6.4.1 ë‹¤ëŒ€ë‹¤: ë‹¨ë°©í–¥
```java
@Entity
public class Member {
    @Id @Column(name = "MEMBER_ID")
    private String id;
    
    private String username;
    
    @ManyToMany
    @JoinTable(name = "MEMBER_PRODUCT", joinColumns = @JoinColumn(name = "MEMBER_ID"),
    inverseJoinColumns = @JoinColumn(name = "PRODUCT_ID"))
    private List<Product> products = new ArrayList<Product>();
    
}

/** ====================================== */

@Entity
public class Product {
    @Id @Column(name = "PRODUCT_ID")
    private String id;
    
    private String name;
}
```
+ @ManyToMany ì™€ @JoinTableì„ ì‚¬ìš©í•´ì„œ ì—°ê²° í…Œì´ë¸”ì„ ë°”ë¡œ ë§¤í•‘
<br>ë”°ë¼ì„œ íšŒì›ê³¼ ìƒí’ˆì„ ì—°ê²°í•˜ëŠ” íšŒì›_ìƒí’ˆ(Member_product) ì—”í‹°í‹° ì—†ì´ ë§¤í•‘ì„ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤.

| ëª…ì¹­                            | ì„¤ëª…                                      |
|-------------------------------|-----------------------------------------|
| @JoinTable.name               | ì—°ê²° í…Œì´ë¸”ì„ ì§€ì • ì—¬ê¸°ì„œ MEMBER_PRODUCT í…Œì´ë¸”ì„ ì„ íƒí•¨  |
| @JoinTable.joinColumns        | í˜„ì¬ ë°©í–¥ì¸ íšŒì›ê³¼ ë§¤í•‘í•  ì¡°ì¸ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§€ì •í•¨, MEMBER_ID |
| @JoinTable.inverseJoinColumns | ë°˜ëŒ€ ë°©í–¥ì¸ ìƒí’ˆê³¼ ë§¤í•‘í•  ì¡°ì¸ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§€ì •, PRODUCT_ID |

+ MEMBER_PRODUCT í…Œì´ë¸”ì€ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ë‚´ê¸° ìœ„í•´ í•„ìš”í•œ ì—°ê²° í…Œì´ë¸”
+ @ManyToManyë¡œ ë§¤í•‘í•œ ë•ë¶„ì— ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì‚¬ìš©í•  ë•Œ ì—°ê²° í…Œì´ë¸”ì„ ì‹ ê²½ ì“°ì§€ ì•Šì•„ë„ ë¨

#### ë“±ë¡
``` java
public void save() {
    
    Product productA = new Product();
    productA.setId("productA");
    productA.setName("ìƒí’ˆA");
    em.persist(productA);
    
    Member member1 = new Member();
    member1.setId("member1");
    member1.setUsername("íšŒì›1");
    member1.getProducts().add(productA)     // ì—°ê´€ê´€ê³„ ì„¤ì •
    em.persist(member1);
}
```
íšŒì›1ê³¼ ìƒí’ˆAì˜ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ íšŒì›1ì„ ì €ì¥í• ë•Œ ì—°ê²° í…Œì´ë¸”ì—ë„ ê°’ì´ ì €ì¥ëœë‹¤.
```
INSERT INTO PRODUCT ...
INSERT INTO MEMBER ...
INSERT INTO MEMBER_PRODUCT ...
```

#### ì¡°íšŒ
``` java
public void find() {
    
    Member member = em.find(Member.class, "member");
    List<Product> products = member.getProducts(); // ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
    for (Product product : products) {
        System.out.println("product.name = " + product.getName());
    }
}
```
+ member.getProducts()ë¥¼ í˜¸ì¶œí•´ì„œ ìƒí’ˆ ì´ë¦„ì„ ì¶œë ¥í•˜ë©´ ë‹¤ìŒ SQLì´ ì‹¤í–‰ë¨
```
SELECT * FROM MEMBER_PRODUCT MP
INNER JOIN PRODUCT P ON MP.PRODUCCT_ID = P.PRODUCT_ID
WHERE MP.MEMBER_ID = ?
```
+ ì—°ê²° í…Œì´ë¸”ì¸ MEMBER_PRODUCT ì™€ ìƒí’ˆ í…Œì´ë¸”ì„ ì¡°ì¸í•´ì„œ ì—°ê´€ëœ ìƒí’ˆì„ ì¡°íšŒ
+ @ManyToMany ë•ë¶„ì— ë³µì¡í•œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì•„ì£¼ ë‹¨ìˆœí•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

### 6.4.2 ë‹¤ëŒ€ë‹¤: ì–‘ë°©í–¥
+ ë‹¤ëŒ€ë‹¤ ë§¤í•‘ì´ë¯€ë¡œ ì—­ë°©í–¥ë„ @ManyToManyë¥¼ ì‚¬ìš©
+ ì–‘ìª½ ì¤‘ ì›í•˜ëŠ” ê³³ì— mappedByë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì§€ì •(mappedBy ê°€ ì—†ëŠ” ê³³ì´ ì—°ê´€ê´€ê³„ ì£¼ì¸)
```java
@Entity
public class Product {
    
    @Id
    private String id;
    
    @ManyToMany(mappedBy = "products")  // ì—­ë°©í–¥ ì¶”ê°€
    private List<Member> members;
}
```
```
member.getProducts().add(product);
product.getMembers().add(member);
```
ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ì¶”ê°€í•´ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í¸ë¦¬

```java
public void addProduct(Product product) {
    products.add(product);
    product.getMembers().add(this);
}
```
```
member.addProduct(product);
```
+ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ì¶”ê°€í–ˆìœ¼ë¯€ë¡œ ê°„ë‹¨íˆ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í•˜ë©´ ëœë‹¤.

``` java
public void findInverse() {
    Product product = em.find(Product.class, "productA");
    List<Member> members = product.getMembers();
    for (Member member : members) {
        System.out.println("member = " + member.getUsername());
    }
}
```
+ ì—­ë°©í–¥ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰

### 6.4.3 ë‹¤ëŒ€ë‹¤: ë§¤í•‘ì˜ í•œê³„ì™€ ê·¹ë³µ, ì—°ê²° ì—”í‹°í‹° ì‚¬ìš©
+ @ManyToManyë¥¼ ì‚¬ìš©í•˜ë©´ ì—°ê²° í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì£¼ë¯€ë¡œ ë„ë©”ì¸ ëª¨ë¸ì´ ë‹¨ìˆœí•´ì§€ê³  í¸ë¦¬í•´ì§„ë‹¤.
+ ë‹¤ëŒ€ë‹¤ ë§¤í•‘ì„ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ìˆë‹¤.

![img_12.png](./img/img_12.png)
íšŒì›ì´ ìƒí’ˆì„ ì£¼ë¬¸í•˜ë©´ ì—°ê²° í…Œì´ë¸”ì— ë‹¨ìˆœíˆ ì£¼ë¬¸í•œ íšŒì› ì•„ì´ë””ì™€ ìƒí’ˆ ì•„ì´ë””ë§Œ ë‹´ê³  ëë‚˜ì§€ ì•ŠëŠ”ë‹¤.
<br> ë³´í†µì€ ì—°ê²° í…Œì´ë¸”ì— ì£¼ë¬¸ ìˆ˜ëŸ‰ ì»¬ëŸ¼ì´ë‚˜ ì£¼ë¬¸í•œ ë‚ ì§œ ê°™ì€ ì»¬ëŸ¼ì´ ë” í•„ìš”í•˜ë‹¤.

![img_13.png](./img/img_13.png)
ìœ„ì˜ ê·¸ë¦¼ì²˜ëŸ¼ ì—°ê²° ì—”í‹°í‹°ë¥¼ ë§Œë“¤ê³  ì´ê³³ì— ì¶”ê°€í•œ ì»¬ëŸ¼ë“¤ì„ ë§¤í•‘í•´ì•¼ í•œë‹¤.
<br> ì—”í‹°í‹° ê°„ì˜ ê´€ê³„ë„ í…Œì´ë¸” ê´€ê³„ì²˜ëŸ¼ ë‹¤ëŒ€ë‹¤ì—ì„œ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ì•¼ í•œë‹¤.
<br> ì—¬ê¸°ì„œëŠ” íšŒì›ì‚¬í’ˆ(MemberProduct) ì—”í‹°í‹°ë¥¼ ì¶”ê°€í–ˆë‹¤.

```java
@Entity
public class Member {
    @Id @Column(name = "MEMBER_ID")
    private String id;
    
    // ì—­ë°©í–¥
    @OneToMany(mappedBy = "member")
    private List<MemberProduct> memberProducts;
}
```
+ íšŒì›ê³¼ íšŒì›ìƒí’ˆì„ ì–‘ë°©í–¥ ê´€ê³„ë¡œ ë§Œë“¤ì—ˆë‹¤.
+ íšŒì›ìƒí’ˆ ì—”í‹°í‹° ìª½ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë‹¤.
+ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ì•„ë‹Œ íšŒì›ì˜ Member.memberProductsì—ëŠ” mappedByë¥¼ ì‚¬ìš©í–ˆë‹¤.

```java
@Entity
public class Product {
    @Id @Column(name = "PRODUCT_ID")
    private String id;
    
    private String name;
}
```
+ ì—¬ê¸°ì„œ ìƒí’ˆ ì½”ë“œ ì—”í‹°í‹°ì—ì„œ íšŒì›ìƒí’ˆ ì—”í‹°í‹°ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ ê¸°ëŠ¥ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨í•´ì„œ ì—°ê´€ê´€ê³„ë¥¼ ë§Œë“¤ì§€ ì•Šì•˜ë‹¤.

``` java
// íšŒì›ìƒí’ˆ ì—”í‹°í‹° ì½”ë“œ 
@Entity
@IdClass(MemberProductId.class)
public class MemberProduct {
    @Id
    @ManyToOne
    @JoinColumn(name = "MEMBER_ID")
    private Member member;          // MemberProductId.member ì™€ ì—°ê²°
    
    @Id
    @ManyToOne
    @JoinColumn(name = "PRODUCT_ID")
    private Product product;        // MemberProductId.productì™€ ì—°ê²°
    
    private int orderAmount;
}
```
```java
// íšŒì›ìƒí’ˆ ì‹ë³„ì í´ë˜ìŠ¤
public class MemberProductId implements Serializable {
    
    private String member;          // MemberProduct.memberì™€ ì—°ê²°
    private String product;         // MemberProduct.productì™€ ì—°ê²°
    
    // hashCode and equals
    
    @Override
    public boolean equals(Object o) {}
    
    @Override
    public int hashCode(){}
}
```
íšŒì›ìƒí’ˆ(MemberProduct) ì—”í‹°í‹°ë¥¼ ë³´ë©´ ê¸°ë³¸ í‚¤ë¥¼ ë§¤í•‘í•˜ëŠ” @Id ì™€ ì™¸ë˜í‚¤ë¥¼ ë§¤í•‘í•˜ëŠ” @JoinColumnì„ ë™ì‹œì— ì‚¬ìš©í•´ì„œ ê¸°ë³¸í‚¤ + ì™¸ë˜í‚¤ë¥¼ í•œë²ˆì— ë§¤í•‘í–ˆë‹¤.
<br>@IdClassë¥¼ ì‚¬ìš©í•´ì„œ ë³µí•© ê¸°ë³¸ í‚¤ë¥¼ ë§¤í•‘í–ˆë‹¤.

#### ğŸ”» ë³µí•© ê¸°ë³¸ í‚¤
íšŒì›ìƒí’ˆ ì—”í‹°í‹°ëŠ” ê¸°ë³¸ í‚¤ê°€ MEMBER_IDì™€ PRODUCT_IDë¡œ ì´ë£¨ì–´ì§„ ë³µí•© ê¸°ë³¸í‚¤ë‹¤.
<br> JPAì—ì„œ ë³µí•© í‚¤ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë³„ë„ì˜ ì‹ë³„ì í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
<br> ì—”í‹°í‹°ì— @IdClassë¥¼ ì‚¬ìš©í•´ì„œ ì‹ë³„ì í´ë˜ìŠ¤ë¥¼ ì§€ì •í•˜ë©´ ëœë‹¤. 
<br> ë³µí•© í‚¤ë¥¼ ìœ„í•œ ì‹ë³„ì í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì´ ìˆë‹¤.
+ ë³µí•© í‚¤ëŠ” ë³„ë„ì˜ ì‹ë³„ì í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
+ Serializableì„ êµ¬í˜„í•´ì•¼ í•œë‹¤.
+ equalsì™€ hashCode ë©”ì†Œë“œë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
+ ì‹ë³„ì í´ë˜ìŠ¤ëŠ” public ì´ì–´ì•¼ í•œë‹¤.
+ @IdClassë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• ì™¸ì— @EmbeddedIdë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.

#### ğŸ”» ì‹ë³„ ê´€ê³„
íšŒì›ìƒí’ˆì€ íšŒì›ê³¼ ìƒí’ˆì˜ í‚¤ë³¸ í‚¤ë¥¼ ë°›ì•„ì„œ ìì‹ ì˜ ê¸°ë³¸ í‚¤ë¡œ ì‚¬ìš©í•œë‹¤.
<br> ì´ë ‡ê²Œ ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë°›ì•„ì„œ ìì‹ ì˜ ê¸°ë³¸ í‚¤ + ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë°ì´í„°ë² ì´ìŠ¤ ìš©ì–´ë¡œ `ì‹ë³„ê´€ê³„`ë¼ í•œë‹¤.

#### ì •ë¦¬
```
íšŒì›ìƒí’ˆ(MemberProduct)ì€ íšŒì›ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë°›ì•„ì„œ ìì‹ ì˜ ê¸°ë³¸ í‚¤ë¡œ ì‚¬ìš©í•¨ê³¼ ë™ì‹œì— íšŒì›ê³¼ì˜ ê´€ê³„ë¥¼ ìœ„í•œ ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•œë‹¤.
ê·¸ë¦¬ê³  ìƒí’ˆì˜ ê¸°ë³¸ í‚¤ë„ ë°›ì•„ì„œ ìì‹ ì˜ ê¸°ë³¸ í‚¤ë¡œ ì‚¬ìš©í•¨ê³¼ ë™ì‹œì— ìƒí’ˆê³¼ì˜ ê´€ê³„ë¥¼ ìœ„í•œ ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•œë‹¤.
ë˜í•œ MemberProductId ì‹ë³„ì í´ë˜ìŠ¤ë¡œ ë‘ ê¸°ë³¸ í‚¤ë¥¼ ë¬¶ì–´ì„œ ë³µí•© ê¸°ë³¸ í‚¤ë¡œ ì‚¬ìš©í•œë‹¤.
```

``` java
public void save() {
    
    // íšŒì›ì €ì¥
    Member member1 = new Member();
    member1.setId("member1");
    member1.setUsername("íšŒì›1");
    em.persist(member1);
    
    // ìƒí’ˆì €ì¥
    Product productA = new Product();
    productA.setId("productA");
    productA.setName("ìƒí’ˆ1");
    em.persist(productA);
    
    // íšŒì›ìƒí’ˆ ì €ì¥
    MemberProduct memberProduct = new MemberProduct();
    memberProduct.setMember(member1);       // ì£¼ë¬¸ íšŒì› - ì—°ê´€ê´€ê³„ ì„¤ì •
    memberProduct.setProduct(productA);     // ì£¼ë¬¸ ìƒí’ˆ - ì—°ê´€ê´€ê³„ ì„¤ì •
    memberProduct.setOrderAmount(2);        // ì£¼ë¬¸ìˆ˜ëŸ‰
    
    em.persist(memberProduct);
}
```
íšŒì›ìƒí’ˆ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ë©´ì„œ ì—°ê´€ëœ íšŒì› ì—”í‹°í‹°ì™€ ìƒí’ˆ ì—”í‹°í‹°ë¥¼ ì„¤ì •í–ˆë‹¤.
<br> íšŒì›ìƒí’ˆ ì—”í‹°í‹°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë  ë•Œ ì—°ê´€ëœ íšŒì›ì˜ ì‹ë³„ìì™€ ìƒí’ˆì˜ ì‹ë³„ìë¥¼ ê°€ì ¸ì™€ ìì‹ ì˜ ê¸°ë³¸ í‚¤ ê°’ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

``` java
public void find() {
    
    // ê¸°ë³¸ í‚¤ ê°’ ìƒì„±
    MemberProductId memberProductId = new MemberProductId();
    memberProductId.setMember("member1");
    memberProductId.setProduct("productA");
    
    MemberProduct memberProduct = em.find(MemberProduct.class, memberProductId);
    
    Member member = memberProduct.getMember();
    Product product = memberProduct.getProduct();
    
    System.out.println("member = " + member.getUsername());
    System.out.println("product = " + product.getName());
    System.out.println("orderAmount = " + memberProduct.getOrderAmount());
}
```

ë³µí•© í‚¤ëŠ” í•­ìƒ ì‹ë³„ì í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤. em.find()ë¥¼ ë³´ë©´ ìƒì„±í•œ ì‹ë³„ì í´ë˜ìŠ¤ë¡œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œë‹¤.

### 6.4.4 ë‹¤ëŒ€ë‹¤: ìƒˆë¡œìš´ í‚¤ë³¸ í‚¤ ì‚¬ìš©
ì±…ì—ì„œ ì¶”ì²œí•˜ëŠ” ê¸°ë³¸ í‚¤ ìƒì„± ì „ëµì€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ëŠ” ëŒ€ë¦¬ í‚¤ Long ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
<br> ì´ê²ƒì˜ ì¥ì ì€ ê°„í¸í•˜ê³  ê±°ì˜ ì˜êµ¬ì ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆìœ¼ë©° ë¹„ì¦ˆë‹ˆìŠ¤ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
<br> ORM ë§¤í•‘ ì‹œì— ë³µí•© í‚¤ë¥¼ ë§Œë“¤ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ ê°„ë‹¨íˆ ë§¤í•‘ì„ ì™„ì„±í•  ìˆ˜ ìˆë‹¤.

![img_14.png](./img/img_14.png)
ìœ„ì˜ ê·¸ë¦¼ì€ ì—°ê²° í…Œì´ë¸”ì— ìƒˆë¡œìš´ ê¸°ë³¸ í‚¤ë¥¼ ì‚¬ìš©í•œ ë°©ì‹
<br> ORDER_IDë¼ëŠ” ìƒˆë¡œìš´ ê¸°ë³¸ í‚¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³  MEMBER_ID, PRODUCT_ID ì»¬ëŸ¼ì€ ì™¸ë˜ í‚¤ë¡œë§Œ ì‚¬ìš©í•œë‹¤.

```java
@Entity
public class Order {
    @Id @GeneratedValue
    @Column(name = "ORDER_ID")
    private Long id;
    
    @ManyToOnew
    @JoinColumn(name = "MEMBER_ID")
    private Member member;
    
    @ManyToOne
    @JoinColumn(name = "PRODUCT_ID")
    private Product product;
    
    private int orderAmount;
}
```
ëŒ€ë¦¬ í‚¤ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì´ì „ì— ë³´ì•˜ë˜ ì‹ë³„ ê´€ê³„ì— ë³µí•© í‚¤ë¥¼ ì‚¬ìš©í•œ ê²ƒë³´ë‹¤ ë§¤í•‘ì´ ë‹¨ìˆœí•˜ê³  ì´í•´í•˜ê¸° ì‰½ë‹¤.

``` java
@Entity
public class Member {
    @Id @Column(name = "MEMBER_ID")
    private String id;
    private String username;
    
    @OneToMany(mappedBy = "member")
    private List<Order> orders = new ArrayList<Order>();
}

@Entity
public class Product {
    @Id @Column(name = "PRODUCT_ID")
    private String id;
    private String name;
}
```

``` java
public void save() {
    // íšŒì› ì €ì¥
    Member member1 = new Member();
    member1.setId("member1");
    member1.setUsername("íšŒì›1");
    em.persist(member1);
    
    // ìƒí’ˆ ì €ì¥
    Product productA = new Product();
    productA.setId("productA");
    productA.setName("ìƒí’ˆ1");
    em.persist(productA);
    
    // ì£¼ë¬¸ ì €ì¥
    Order order = new Order();
    order.setMember(member1);       // ì£¼ë¬¸íšŒì› - ì—°ê´€ê´€ê³„ ì„¤ì •
    order.setProduct(productA);     // ì£¼ë¬¸ìƒí’ˆ - ì—°ê´€ê´€ê³„ ì„¤ì •
    order.setOrderAmount(2);        // ì£¼ë¬¸ìˆ˜ëŸ‰
    em.persist(order);
}
```

``` java
public void find() {
    
    Long orderId = 1L;
    Order order = em.find(Order.class, orderId);
    
    Member member = order.getMember();
    Product product = order.getProduct();
    
    System.out.println("member = " + member.getUsername());
    System.out.println("product = " + product.getName());
    System.out.println("orderAmount = " + order.getOrderAmount());
}
```
ì‹ë³„ì í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì„œ ì½”ë“œê°€ í•œê²° ë‹¨ìˆœí•´ì¡Œë‹¤.

### 6.4.5 ë‹¤ëŒ€ë‹¤ ì—°ê´€ê´€ê³„ ì •ë¦¬
ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤ ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ë‚´ê¸° ìœ„í•´ ì—°ê²° í…Œì´ë¸”ì„ ë§Œë“¤ ë•Œ ì‹ë³„ìë¥¼ ì–´ë–»ê²Œ êµ¬ì„±í• ì§€ ì„ íƒí•´ì•¼ í•œë‹¤.
+ ì‹ë³„ ê´€ê³„: ë°›ì•„ì˜¨ ì‹ë³„ìë¥¼ ê¸°ë³¸ í‚¤ + ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•œë‹¤.
+ ë¹„ì‹ë³„ ê´€ê³„: ë°›ì•„ì˜¨ ì‹ë³„ìëŠ” ì™¸ë˜ í‚¤ë¡œë§Œ ì‚¬ìš©í•˜ê³  ìƒˆë¡œìš´ ì‹ë³„ìë¡œ ì¶”ê°€í•œë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ì—ì„œëŠ” 1ë²ˆì²˜ëŸ¼ ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë°›ì•„ì„œ ìì‹ í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤ + ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì‹ë³„ ê´€ê³„ë¼ê³  í•œë‹¤.
<br> 2ë²ˆì²˜ëŸ¼ ë‹¨ìˆœíˆ ì™¸ë˜ í‚¤ë¡œë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë¹„ì‹ë³„ ê´€ê³„ë¼ê³  í•œë‹¤.
<br> ê°ì²´ ì…ì¥ì—ì„œ ë³´ë©´ 2ë²ˆì²˜ëŸ¼ ë¹„ì‹ë³„ ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë³µí•© í‚¤ë¥¼ ìœ„í•œ ì‹ë³„ì í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ ë‹¨ìˆœí•˜ê³  í¸ë¦¬í•˜ê²Œ ORM ë§¤í•‘ í•  ìˆ˜ ìˆë‹¤.
