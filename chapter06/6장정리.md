# 6ì¥ ë‹¤ì–‘í•œ ì—°ê´€ê´€ê³„ ë§¤í•‘

---

## 6.1 ë‹¤ëŒ€ì¼
ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ 1:N ê´€ê³„ì—ì„œ ì™¸ë˜ í‚¤ëŠ” í•­ìƒ ë‹¤ìª½ì— ìˆë‹¤.
<br>ë”°ë¼ì„œ ê°ì²´ ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í•­ìƒ ë‹¤ìª½ì´ë‹¤.
<br>ì˜ˆë¥¼ë“¤ì–´ 5ì¥ì—ì„œ ì´ì•¼ê¸°í–ˆë˜ íšŒì›(N)ê³¼ íŒ€(1)ì´ ìˆìœ¼ë©´ íšŒì›ì´ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ë‹¤.

### 6.1.1 ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥[N:1]

---
![img_01.png](./img/img_01.png)

``` java
@Entity
public class Member {
    
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")       
    private Team team;
    
    // Getter, Setter...
}

/** ====================================== */

@Entity
public class Team {
    
    @Id @GeneratedValue
    @Column(name= "TEAM_ID")
    private Long id;
    
    private String name;
    
    // Getter, Setter ...
    
}
```
íšŒì›ì€ Member.team ìœ¼ë¡œ íŒ€ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆì§€ë§Œ ë°˜ëŒ€ë¡œ íŒ€ì—ëŠ” íšŒì›ì„ ì°¸ì¡°í•˜ëŠ” í•„ë“œê°€ ì—†ë‹¤.
<br> ë”°ë¼ì„œ íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ë‹¨ë°˜í–¥ ì—°ê´€ê´€ê³„ì´ë‹¤.

```
@JoinColumn(name = "TEAM_ID") ë¥¼ ì‚¬ìš©í•´ì„œ Member.team í•„ë“œë¥¼ TEAM_ID ì™¸ë˜ í‚¤ì™€ ë§¤í•‘
ë”°ë¼ì„œ Member.team í•„ë“œë¡œ íšŒì› í…Œì´ë¸”ì˜ TEAM_ID ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬
```

### 6.1.2 ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥[N:1, 1:N]
![img_02.png](./img/img_02.png)
```java
@Entity
public class Member {
    @Id @GenerateValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
    
    public void setTeam(Team team) {
        this.team = team;
        // ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
        if(!team.getMembers().contains(this)) {
            team.getMembers().add(this);
        }
    }
}

/** ====================================== */

@Entity
public class Team {

    @Id @GeneratedValue
    @Column(name= "TEAM_ID")
    private Long id;

    private String name;

    @OneToMany(mappedBy = "team")
    private List<Member> members = new ArrayList<Member>();
    
    public void addMember(Member member) {
        this.members.add(member);
        if(member.getTeam() != this) {      // ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
            member.getTeam(this);
        }
    }
    
    // Getter, Setter ...

}
```
#### ğŸ”» ì–‘ë°©í–¥ì€ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìª½ì´ ì—°ê´€ê´€ê³„ ì£¼ì¸
+ ì¼ëŒ€ë‹¤ì™€ ë‹¤ëŒ€ì¼ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ë‹¤(N)ì— ì™¸ë˜ í‚¤ê°€ ìˆë‹¤. 
<br> ìœ„ì˜ ì˜ˆëŠ” MEMBER í…Œì´ë¸”ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ Member.teamì´ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ë‹¤.
+ JPAëŠ” ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í• ë•Œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œ ì‚¬ìš©
+ ì£¼ì¸ì´ ì•„ë‹Œ Team.membersëŠ” ì¡°íšŒë¥¼ ìœ„í•œ JPQLì´ë‚˜ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í• ë•Œ ì‚¬ìš©

#### ğŸ”» ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ì„œë¡œë¥¼ ì°¸ì¡° 
+ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ì„œë¡œ ì°¸ì¡°í•´ì•¼ í•œë‹¤.
<br> ì–´ëŠ í•œ ìª½ë§Œ ì°¸ì¡°í•˜ë©´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ì„±ë¦½í•˜ì§€ ì•ŠìŒ
<br> í•­ìƒ ì„œë¡œ ì°¸ì¡°í•˜ê²Œ í•˜ë ¤ë©´ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ì‘ì„±í•˜ëŠ”ê²ƒì´ ì¢‹ë‹¤. 
--> setTeam(), addMember() ê°™ì€ ë©”ì†Œë“œ
+ í¸ì˜ ë©”ì†Œë“œëŠ” í•œ ê³³ì—ë§Œ ì‘ì„±í•˜ê±°ë‚˜ ì–‘ìª½ ë‹¤ ì‘ì„±í•  ìˆ˜ ìˆëŠ”ë°, ì–‘ìª½ì— ë‹¤ ì‘ì„±í•˜ë©´ ë¬´í•œë£¨í”„ì— ë¹ ì§€ë¯€ë¡œ ì£¼ì˜

## 6.2 ì¼ëŒ€ë‹¤
ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” ë‹¤ëŒ€ì¼ ê´€ê³„ì˜ ë°˜ëŒ€ ë°©í–¥ì´ë‹¤.
ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” ì—”í‹°í‹°ë¥¼ í•˜ë‚˜ ì´ìƒ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìë°” ì»¬ë ‰ì…˜ì¸ Collection, List, Set, Map ì¤‘ì— í•˜ë‚˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

### 6.2.1 ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥[1:N]
í•˜ë‚˜ì˜ íŒ€ì€ ì—¬ëŸ¬ íšŒì›ì„ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ”ë° ì´ëŸ° ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤ ê´€ê³„
íŒ€ì€ íšŒì›ë“¤ì€ ì°¸ì¡°í•˜ì§€ë§Œ ë°˜ëŒ€ë¡œ íšŒì›ì€ íŒ€ì„ ì°¸ì¡°í•˜ì§€ ì•Šìœ¼ë©´ ë‘˜ì˜ ê´€ê³„ëŠ” ë‹¨ë°©í–¥
(ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ê´€ê³„ëŠ” JPA 2.0 ë¶€í„° ì§€ì›)
![img_03.png](./img/img_03.png)
+ íŒ€ ì—”í‹°í‹°ì˜ Team.membersë¡œ íšŒì› í…Œì´ë¸”ì˜ TEAM_ID ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•œë‹¤.
+ ë³´í†µ ìì‹ ì´ ë§¤í•‘í•œ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ì´ ë§¤í•‘ì€ ë°˜ëŒ€ìª½ í…Œì´ë¸”ì— ìˆëŠ” ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬
+ ì¼ëŒ€ë‹¤ ê´€ê³„ì—ì„œ ì™¸ë˜ í‚¤ëŠ” í•­ìƒ ë‹¤ìª½ì— ìˆì§€ë§Œ ë‹¤ìª½ì¸ Member ì—”í‹°í‹°ì—ëŠ” ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•  ìˆ˜ ìˆëŠ” ì°¸ì¡° í•„ë“œê°€ ì—†ê³  
<br> ë°˜ëŒ€ìª½ì¸ Team ì—”í‹°í‹°ì—ë§Œ ì°¸ì¡° í•„ë“œì¸ membersê°€ ìˆì–´ ë°˜ëŒ€í¸ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬

```java
@Entity
public class Team {
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;
    
    private String name;
    
    @OneToMany
    @JoinColumn(name = "TEAM_ID")       // MEMBER í…Œì´ë¸”ì˜ TEAM_ID (FK)
    private List<Member> members = new ArrayList<Member>();
    
    // Getter, Setter..
}

/** ====================================== */

@Entity
public class Member {
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    
    private String username;
    
    // Getter, Setter ...
}
```
+ ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ê´€ê³„ë¥¼ ë§¤í•‘í•  ë•Œ @JoinColumnì„ ëª…ì‹œí•´ì•¼ í•œë‹¤.
<br> ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ JPAëŠ” ì—°ê²° í…Œì´ë¸”ì„ ì¤‘ê°„ì— ë‘ê³  ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¡°ì¸ í…Œì´ë¸” ì „ëµì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•´ì„œ ë§¤í•‘

#### ğŸ”» ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì˜ ë‹¨ì 
+ ë§¤í•‘í•œ ê°ì²´ê°€ ê´€ë¦¬í•˜ëŠ” ì™¸ë˜ í‚¤ê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì— ìˆë‹¤ëŠ” ì 
<br> ë³¸ì¸ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆìœ¼ë©´ ì—”í‹°í‹°ì˜ ì €ì¥ê³¼ ì—°ê´€ê´€ê³„ ì²˜ë¦¬ë¥¼ Insert SQL í•œë²ˆìœ¼ë¡œ ëë‚¼ ìˆ˜ ìˆì§€ë§Œ,
ë‹¤ë¥¸ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆìœ¼ë©´ ì—°ê´€ê´€ê³„ ì²˜ë¦¬ë¥¼ ìœ„í•œ Update SQLì„ ì¶”ê°€ë¡œ ì‹¤í–‰í•´ì•¼ í•œë‹¤.

```java
public void testSave() {
    
    Member member1 = new Member("member1");
    Member member2 = new Member("member2");
    
    Team team1 = new Team("team1");
    team1.getMembers().add(member1);
    team1.getMembers().add(member2);
    
    em.persist(member1);    // Insert member1
    em.persist(member2);    // Insert member2
    em.persist(team1);      // Insert team, update member1.fk, update member2.fk
        
    transaction.commit();
}
```
+ Member ì—”í‹°í‹°ëŠ” Team ì—”í‹°í‹°ë¥¼ ëª¨ë¥¸ë‹¤. 
<br> ê·¸ë¦¬ê³  ì—°ê´€ê´€ê³„ì— ëŒ€í•œ ì •ë³´ëŠ” Team ì—”í‹°í‹°ì˜ membersê°€ ê´€ë¦¬í•œë‹¤.
+ Member ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•ŒëŠ” MEMBER í…Œì´ë¸”ì˜ TEAM_ID ì™¸ë˜ í‚¤ì— ì•„ë¬´ ê°’ë„ ì €ì¥ë˜ì§€ ì•ŠìŒ
+ Team ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ Team.membersì˜ ì°¸ì¡° ê°’ì„ í™•ì¸í•´ì„œ íšŒì› í…Œì´ë¸”ì— ìˆëŠ” TEAM_ID ì™¸ë˜ í‚¤ë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.

#### ğŸ”» ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ë³´ë‹¤ëŠ” ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©
ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ë¥¸ í…Œì´ë¸”ì—ì„œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.
<br> ì´ê²ƒì€ ì„±ëŠ¥ ë¬¸ì œë„ ìˆì§€ë§Œ ê´€ë¦¬ë„ ë¶€ë‹´ìŠ¤ëŸ½ë‹¤.
<br> ì´ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì€ ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©
<br> ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ì€ ë³¸ì¸ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆì–´ ë‹¨ë°©í–¥ ë§¤í•‘ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

### 6.2.2 ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥[1:N, N:1]
ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ ë§¤í•‘ì€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©° ëŒ€ì‹  ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©
(ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ê³¼ ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ì€ ì‚¬ì‹¤ ë˜‘ê°™ì€ ë§ì´ë‹¤.)
+ ì–‘ë°©í–¥ ë§¤í•‘ì—ì„œ @OneToManyëŠ” ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ë  ìˆ˜ ì—†ë‹¤.
+ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ íŠ¹ì„±ìƒ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ëŠ” í•­ìƒ ë‹¤ ìª½ì— ì™¸ë˜ í‚¤ê°€ ìˆë‹¤.
+ ë”°ë¼ì„œ @OneToMany, @ManyToOne ë‘˜ ì¤‘ì— ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í•­ìƒ ë‹¤ ìª½ì¸ @ManyToOneì„ ì‚¬ìš©í•˜ëŠ” ê³³ì´ë‹¤.
+ ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì´ ì™„ì „íˆ ë¶ˆê°€ëŠ¥í•œ ê²ƒì´ ì•„ë‹ˆë©° ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ ë°˜ëŒ€í¸ì— ê°™ì€ ì™¸ë˜ í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì½ê¸° ì „ìš©ìœ¼ë¡œ í•˜ë‚˜ ì¶”ê°€í•˜ë©´ ëœë‹¤.

![img_04.png](./img/img_04.png)

```java
@Entity
public class Team {
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;
    
    private String name;
    
    @OneToMay
    @JoinColumn(name = "TEAM_ID")
    private List<Member> members = new ArrayList<Member>();
    
    //Getter, Setter...
}
```