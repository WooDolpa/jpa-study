# 10장 객체지향 쿼리 언어

---

## 10.1 객체지향 쿼리 소개
다음은 가장 단순한 검색방법이다.
+ 식별자로 조회 EntityManager.find()
+ 객체 그래프 탐색(예:a.getB().getC())

이 두가지 검색방법만으로 애플리케이션을 개발하기는 어렵다.

<br> 예를들어 회원테이블에서 나이가 30살 이상인 회원을 조회하고 싶을때 
모든 회원 엔티티를 메모리에 올려두고 에플리케이션에서 30살 이상인 회원을 검색하는 것은 현실성이 없다.
<br> 따라서 좀 더 현실적이고 복잡한 검색 방법이 필요한데 결국 데이터는 데이터베이스에 있으므로 SQL로 
필요한 내용을 최대한 걸러서 조회해야 한다.
<br> 그런데 ORM을 사용하면 테이블이 아닌 엔티티 개체로 개발하므로 테이블 대상이 아닌 엔티티 객체 대상으로 하는 방법이 필요하다.
<br> 이 문제를 해결하기 위해 만들어진 것이 `JPQL`이며, 다음과 같은 특징이 있다.

+ 테이블이 아닌 객체를 대상으로 검색하는 객체지향 쿼리
+ SQL을 추상화해서 특정 데이터베이스 SQL에 의존하지 않는다.

SQL이 데이터베이스 테이블을 대상으로 하는 데이터 중심의 쿼리라면 JPQL은 엔티티 객체를 대상으로 하는 객체지향 쿼리이다.
<br> JPQL을 사용하면 JPA는 이 JPQL을 분석한 다음 적절한 SQL을 만들어 데이터베이스를 조회한다. 그리고 조회한 결과로
엔티티 객체를 생성해서 반환한다. 

JPQL을 한마디로 정의하면 객체지향 SQL이라고할 수 있으며 SQL 문법이 비슷하여 몇가지 차이점만 이해하면 쉽게 적응이 가능하다.

JPA는 JPQL뿐만 아니라 다양한 검색 방법을 제공하며 JPA가 공식 지원하는 기능은 다음과 같다.
+ JPQL (Java Persistence Query Language)
+ Criteria 쿼리 (Criteria Query) : JPQL을 편하게 작성하도록 도와주는 API, 빌더 클래스 모음
+ 네이티브 SQL (Native SQL) : JPA에서 JPQL 대신 직접 SQL을 사용할 수 있다.

JPA가 공식으로 지원하지 않는 검색 방법
+ QueryDSL : Criteria 쿼리처럼 JPQL을 편하게 작성하도록 도와주는 빌더 클래스모음, 비표준 오픈소스 프레임워크
+ JDBC 직접사용, MyBatis 같은 SQL 매퍼 프레임워크 사용 : 필요하면 JDBC를 직접 사용

## 10.1.1 JPQL 소개
엔티티 객체를 조회하는 객체지향 쿼리이다.
<br> 문법은 SQL과 비슷하고 ANSI 표준 SQL이 제공하는 기능을 유사하게 지원한다.
<br> JPQL은 SQL을 추상화해서 특정 데이터베이스에 의존하지 않는다. 
그리고 데이터베이스  방언(Dialect)만 변경하면 JPQL을 수정하지 않아도 된다.
<br> JPQL은 SQL보다 간결하다. 엔티티 직접 조회, 묵시적 조인, 다형성 지원으로 SQL보다 코드가 간결하다.

``` java
@Entity(name="Member")      // name 속성의 기본값은 클래스 명
public class Member {

    @Column(name="name")
    private String username;
    //...
}
```
```
// 쿼리 생성
String jpql = "select m from Member as m where m.username = 'kim'";
List<Member> resultList = em.createQuery(jpql, Member.class).getResultList();
```
위의 예제는 JPQL을 사용하여 회원이름이 kim인 엔티티를 조회하는 방법이다.
조건절에 보면 m.username 은 테이블 컬럼명이 아니라 엔티티 객체의 필드명이다. 
em.createQuery() 메소드에 실행할 JPQL 구문과 반환할 엔티티 클래스 타입을 넘겨주고 getResultList()
메소드를 실행하면 JPA는 JPQL을 SQL로 변환해서 데이터베이스를 조회하고 결과값을 엔티티로 생성해서 반환한다.

## 10.1.2 Criteria 쿼리 소개



